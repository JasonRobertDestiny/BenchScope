# Codex开发指令：多来源推送多样性与低优先级召回优化 PRD

## 背景与现状
- 高/中优先级推送几乎被 GitHub 占满；arXiv/HuggingFace/HELM 等来源被压低评分（总分、MGX 适配度），导致不被推送。
- arXiv 尽管有大量“最新且相关”的论文，但因评分低而落入 low 队列且未推送，造成信息源单一。
- 目标：保持质量前提下，提升来源多样性（覆盖 arXiv / HuggingFace / HELM / DBEngines / TechEmpower / GitHub），保证“最新且相关”内容有展示。

## 问题诊断
1) 评分侧偏向 GitHub：活跃度、可复现性对论文型来源天然低，拉低总分。
2) 推送门槛统一：中/高优先级阈值对论文不公平；low 队列未推送。
3) 推送策略无来源配额：单一来源可挤占全部卡位。

## 目标
- 推送来源 ≥ 4 个（必含 arXiv 与至少 1 个非 GitHub）。
- 每次推送至少包含 2 条“最新且相关”的低优先级 arXiv/HF/HELM 候选（若存在）。
- 保持整体质量：总分≥6.0；MGX 适配度≥6.0（或论文类来源使用降噪后的软阈值）。

## 方案设计（推荐方案）
### 1) 分来源配额 + 软阈值
- 中优先级摘要：按来源取 TopK (score 排序)，每个来源至少 1 条；总数上限 8。
- 高优先级：仍按全局得分排序，但允许对论文来源增加 0.5~1.0 的“来源加成/再排序权重”。
- 低优先级精选：从 low 队列中挑选“最新且相关”Top2 (arXiv/HF/HELM 优先)，直接附加在摘要末尾的“Latest from papers/datasets”分区。

### 2) 评分调平（非代码重构，轻量调权）
- 对论文来源的活跃度/可复现性引入“来源折扣”：活跃度×0.6，可复现性×0.7；MGX 适配度权重 +0.1。
- 若总分因折扣仍 <6.0，但 MGX≥7.0 且发布时间≤7天，则允许进入“低优先精选”分区。

### 3) 推送文案与分区
- 摘要卡片结构：
  - Top N (全局) — 维持现有行格式。
  - Per-Source Picks — 按来源各 1 条。
  - Latest Papers/Datasets — 低优先精选区，列出 arXiv/HF/HELM 最新 2~3 条（显示来源、MGX、发布日期、链接）。

## 详细实施步骤
1) **常量与配置**
   - `src/common/constants.py` 新增：
     - `FEISHU_PER_SOURCE_TOPK = 1`
     - `FEISHU_LOW_PICK_ENABLED = True`
     - `FEISHU_LOW_PICK_PER_SOURCE = {"arxiv": 2, "huggingface": 1, "helm": 1}`
     - 论文来源活跃度/复现性折扣系数。
2) **评分侧微调（轻量）**
   - 在 scorer 聚合处对论文来源应用折扣和 MGX 加权（不改评分模型，只做后处理）。
3) **推送逻辑调整**
   - `FeishuNotifier._send_medium_priority_summary`：
     - 先选全局 TopN (现有)。
     - 再按来源补齐 `FEISHU_PER_SOURCE_TOPK`（去重）。
     - 低优先精选区：从 low 队列按来源/发布时间取前若干条，附加 Markdown 分区。
4) **日志与监控**
   - 推送日志新增“来源覆盖数”“低优先精选数”。

## 验收标准
- 单次推送来源数 ≥4，且包含 arXiv。
- 低优先精选区出现 arXiv/HF/HELM 最新条目（若存在）。
- 总体推送条数不超过当前上限（避免噪音）。

## 风险与缓解
- **风险：噪音提升** — 通过最低阈值（总分≥6.0，MGX≥6.0）和按来源限额控制。
- **风险：推送过长** — 设总上限（全局TopN + per-source + low精选 ≤ 12）。

## 时间计划
- 开发：0.5 天（配置+推送逻辑调整+轻量评分折扣）。
- 验证：0.5 天（跑一次全流程，检查推送来源覆盖与低优先精选呈现）。

## 回滚方案
- 关闭低优先精选开关；恢复原有推送排序逻辑与评分加权。
